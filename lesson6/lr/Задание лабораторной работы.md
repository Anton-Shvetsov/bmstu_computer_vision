**Оценка точности трекинга**

1. Установите библиотеку `ultralytics`:
`pip install ultralytics`

2. Скачайте датасет [MOT20](https://motchallenge.net/data/MOT20/)
(ссылка внизу страницы - *Get all data (5.0 GB)*)

3. Выполните трекинг людей на последовательностях изображений (запустите скрипт `mot_challenge_tracking_on_sequence_of_frames.py`).
В указанном скрипте нужно указать корректные пути до изображений.

В результате запуска скрипта сформируется папка с результатами трекинга в txt-файлах (MOT20-01.txt, MOT20-02.txt, MOT20-03.txt, MOT20-05.txt),
где каждая строка имеет формат:

`{frame_id},{track_id},{bb_left:.2f},{bb_top:.2f},{bb_width:.2f},{bb_height:.2f},{conf:.6f},-1,-1,-1`

Полученные результаты трекинга нужно сопоставить с ground truth значениями и рассчитать метрики трекинга.

Цель лабораторной работы - сопоставить метрики нескольких трекеров yolo,
опробовать разные вариации модели (`nano`, `small`, `medium` и др.),
поварьировать размер входного изображения (`imgsz` - при большем размере детекция людей работает лучше; при дефолтном размере окна 640 результаты получатся совсем печальными),
минимальный порог для детекций (`conf`),
использовать разные конфигурации трекеров ([botsort.yaml](https://github.com/ultralytics/ultralytics/blob/main/ultralytics/cfg/trackers/botsort.yaml), [bytetrack.yaml](https://github.com/ultralytics/ultralytics/blob/main/ultralytics/cfg/trackers/bytetrack.yaml), попробовать поизменять параметры в этих конфигурационных файлах).

Непосредственно модели yolo обучать не требуется.
Нулевой класс моделей моделей по умолчанию - класс person, тестируем эти модели на датасете MOT20.

4. Расчет метрик трекинга в библиотеке `ultralytics` не реализован.
Для этого нужно будет клонировать репозиторий https://github.com/JonathonLuiten/TrackEval
и установить требуемые зависимости (в отдельном виртуальном окружении python 3.8). Лучше трекинг и расчет метрик делать в разных окружениях, репозиторий расчета метрик проблемный.
```
conda create -n tracking_eval_38_env python=3.8
conda activate tracking_eval_38_env
pip install -r requirements_updated_trackeval.txt
```

Файл `requirements_updated_trackeval.txt` с актуальными версиями библиотек лежит в репозитории.


5. Скачайте архив [data.zip](https://omnomnom.vision.rwth-aachen.de/data/TrackEval/data.zip) и разместите его в папке `TrackEval`.
В этом архиве содержатся информация о ground truth значениях трекинга.
Путь до них после распаковки архива должен быть такой:
`TrackEval/data/gt/mot_challenge/MOT20-train`

6. Проверьте корректность развертывания репозитория для расчета метрик, запустите команду:
```
python scripts/run_mot_challenge.py --BENCHMARK MOT20 --TRACKERS_TO_EVAL MPNTrack --TRACKERS_FOLDER ./data/trackers/mot_challenge --GT_FOLDER ./data/gt/mot_challenge
```
В папке `data` содержатся результаты прогона детектора `MPNTrack` (по пути `TrackEval/data/trackers/mot_challenge/MOT20-train/MPNTrack`), команда ранее просто оценивает, репозиторий развернут корректно.

7. Разместите в папке `TrackEval/data/trackers/mot_challenge/MOT20-train` папку с результатами работы вашего трекера.
Например, папка называется `yolo11s_131225`, она получена после запуска скрипта `mot_challenge_tracking_on_sequence_of_frames.py`.
Она должна быть организована, как папка `MPNTrack`.
Запустите команду расчета метрик трекинга:
```
python scripts/run_mot_challenge.py --BENCHMARK MOT20 --TRACKERS_TO_EVAL yolo11s_131225 --TRACKERS_FOLDER ./data/trackers/mot_challenge --GT_FOLDER ./data/gt/mot_challenge
```

После корректной работы в папке `TrackEval/data/trackers/mot_challenge/MOT20-train/yolo11s_131225` должны сформироваться файлы с метриками (метрики отобразятся и в консоли).

Ваша задача - сделать несколько прогонов моделей yolo с разными параметрами трекинга на датасете `MOT20` и определить предпочтительные параметры и модель.

Ссылки:

[Репозиторий, откуда взята адаптация расчета метрик под yolo](https://github.com/FayalaMohamed/yolov8_tracking_evaluation)

[Issue, где обсуждается, как рассчитать метрики трекинга для yolo](https://github.com/ultralytics/ultralytics/issues/8142)

[Библиотека BoxMOT, в которой реализованы продвинутые методы трекинга + реализована оценка метрик трекинга и подбор гиперпараметров](https://github.com/mikel-brostrom/boxmot)